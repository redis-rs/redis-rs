[[rule]]
when = ["cache-aio", "OR", "connection-manager", "OR", "cluster-async"]
require = [
  "tokio-comp",
  "OR",
  "smol-comp",
  "OR",
  "tokio-rustls-comp",
  "OR",
  "tokio-native-tls-comp",
  "OR",
  "smol-native-tls-comp",
  "OR",
  "smol-rustls-comp",
]

[[rule]]
when = ["tls-rustls"]
forbid = [
  "tokio-comp",
  "OR",
  "smol-comp",
] # tokio-rustls-comp or smol-rustls-comp should be used instead of this combination

[[rule]]
when = ["tls-native-tls"]
forbid = [
  "tokio-comp",
  "OR",
  "smol-comp",
] # tokio-native-tls-comp or smol-native-tls-comp should be used instead of this combination

[[rule]]
when = "tls-rustls-insecure"
require = ["tls-rustls"]

# the native-tls features shouldn't be tested with the rustls features
[[rule]]
when = [
  "tokio-native-tls-comp",
  "OR",
  "smol-native-tls-comp",
  "OR",
  "tls-native-tls",
]
forbid = [
  "tokio-rustls-comp",
  "OR",
  "tls-rustls-webpki-roots",
  "OR",
  "tls-rustls",
  "OR",
  "tls-rustls-insecure",
  "OR",
  "smol-rustls-comp",
]

# we don't need to check whether the smol features are working with the tokio features
[[rule]]
when = [
  "smol-native-tls-comp",
  "OR",
  "smol-comp",
  "OR",
  "smol-rustls-comp",
]
forbid = [
  "tokio-rustls-comp",
  "OR",
  "tokio-native-tls-comp",
  "OR",
  "tokio-comp",
]

# cluster-async is the feature for async work. We don't need to check cluster with any async runtime.
[[rule]]
when = ["cluster"]
forbid = [
  "cluster-async",
  "OR",
  "tokio-rustls-comp",
  "OR",
  "tokio-native-tls-comp",
  "OR",
  "tokio-comp",
  "OR",
  "smol-native-tls-comp",
  "OR",
  "smol-comp",
  "OR",
  "smol-rustls-comp",
]

[[rule]]
when = ["tls-rustls-webpki-roots", "smol-comp"]
require = ["smol-rustls-comp"]

[[rule]]
when = ["tls-rustls-webpki-roots", "tokio-comp"]
require = ["tokio-rustls-comp"]

# ------------------------------------------------------------------------
# Entra ID integration (requires Tokio-based async + TLS compatibility)
# ------------------------------------------------------------------------

# Entra ID is Tokio-only; forbid Smol-based TLS runtimes
[[rule]]
when = "entra-id"
require = ["tokio-comp"]
forbid = ["smol-rustls-comp", "OR", "smol-native-tls-comp"]

# Entra ID with any Rustls-based TLS backend requires `tokio-rustls-comp`
[[rule]]
when = ["entra-id", "AND", ["tls-rustls", "OR", "tls-rustls-webpki-roots"]]
require = ["tokio-rustls-comp"]
forbid = ["NOT", "tokio-rustls-comp"]

# Entra ID with any native-tls backend requires `tokio-native-tls-comp`
[[rule]]
when = ["entra-id", "AND", "tls-native-tls"]
require = ["tokio-native-tls-comp"]
forbid = ["NOT", "tokio-native-tls-comp"]

# The users are expected to use only one connection pool.
[[rule]]
when = "r2d2"
forbid = "bb8"

# The users are expected to use only one hashmap
[[rule]]
when = "ahash"
forbid = "hashbrown"

# The users are expected to use only one big decimal implementation
[[rule]]
when = "rust_decimal"
forbid = "bigdecimal"

# This feature can't run by itself
[[rule]]
when = true
forbid = "aio"

# If you're using the library with sentinel or targeting connection manager, you probably don't want cluster connections
[[rule]]
when = ["sentinel", "OR", "connection-manager"]
forbid = ["cluster", "OR", "cluster-async"]

# these are all included in the `default` feature, so in order to reduce combinatoric explosion, we don't check them individually.
[[rule]]
when = true
forbid = [
  "acl",
  "OR",
  "streams",
  "OR",
  "geospatial",
  "OR",
  "script",
  "OR",
  "num-bigint",
]
